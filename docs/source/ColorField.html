<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='GXC-form-ColorField'>/**
</span> * A form field to select color values in hex format.
 */
Ext.define(&#39;GXC.form.ColorField&#39;, {
    extend: &#39;Ext.form.field.Trigger&#39;,
    alias: &#39;widget.gxc_form_colorfield&#39;,
    requires: [
        &#39;Ext.form.field.VTypes&#39;,
        &#39;Ext.layout.component.field.Text&#39;,
        &#39;Ext.menu.ColorPicker&#39;
    ],

<span id='GXC-form-ColorField-cfg-blankText'>    blankText: &quot;Must have a hexidecimal value in the format [#]ABCDEF.&quot;,
</span>
<span id='GXC-form-ColorField-property-regex'>    /**
</span>     * Regex color values are evaluated against.
     */
    regex: /^#?[0-9a-f]{6}$/i,

<span id='GXC-form-ColorField-method-validateValue'>    validateValue : function(value){
</span>        if(!this.getEl()) {
            return true;
        }

        if (value.length &amp;&amp; !this.regex.test(value)) {
            this.markInvalid(Ext.String.format(this.blankText, value));
            return false;
        }

        this.markInvalid();
        this.setColor(value);
        return true;
    },

<span id='GXC-form-ColorField-method-setValue'>    setValue : function(hex){
</span>        GXC.form.ColorField.superclass.setValue.call(this, hex);
        this.setColor(hex);
    },

<span id='GXC-form-ColorField-method-setColor'>    setColor : function(hex) {
</span>        if (hex) {
            hex = !hex.startsWith(&#39;#&#39;) ? &#39;#&#39; + hex : hex;
        }
        GXC.form.ColorField.superclass.setFieldStyle.call(this, {
            &#39;background-color&#39;: hex,
            &#39;background-image&#39;: &#39;none&#39;,
            &#39;color&#39;: this.isDark(hex) ? &quot;#ffffff&quot; : &quot;#000000&quot;
        });
    },

<span id='GXC-form-ColorField-property-menuListeners'>    menuListeners : {
</span>        select: function(m, d){
            this.setValue(d);
        },
        show : function(){
            this.onFocus();
        },
        hide : function(){
            this.focus();
            var ml = this.menuListeners;
            this.menu.un(&quot;select&quot;, ml.select,  this);
            this.menu.un(&quot;show&quot;, ml.show,  this);
            this.menu.un(&quot;hide&quot;, ml.hide,  this);
        }
    },

<span id='GXC-form-ColorField-method-onTriggerClick'>    /**
</span>     * Called on click events to show color picker component.
     * @param  {Ext.Event} event
     */
    onTriggerClick : function(e){
        if(this.disabled){
            return;
        }

        this.menu = Ext.create(&#39;Ext.menu.ColorPicker&#39;, {
            shadow: true,
            autoShow : true
        });
        this.menu.alignTo(this.inputEl, &#39;tl-bl?&#39;);
        this.menu.doLayout();

        this.menu.on(Ext.apply({}, this.menuListeners, {
            scope:this
        }));

        this.menu.show(this.inputEl);
    },

<span id='GXC-form-ColorField-method-isDark'>    /**
</span>     *  Determine if a color is dark by avaluating brightness according to the
     *  W3C suggested algorithm for calculating brightness of screen colors.
     *  http://www.w3.org/WAI/ER/WD-AERT/#color-contrast
     *
     * @param {String} hex
     * @returns {Boolean}
     */
    isDark: function(hex) {
        var dark = false;
        if(hex) {
            // convert hex color values to decimal
            var r = parseInt(hex.substring(1, 3), 16) / 255;
            var g = parseInt(hex.substring(3, 5), 16) / 255;
            var b = parseInt(hex.substring(5, 7), 16) / 255;
            // use w3C brightness measure
            var brightness = (r * 0.299) + (g * 0.587) + (b * 0.144);
            dark = brightness &lt; 0.5;
        }
        return dark;
    }
});
</pre>
</body>
</html>
