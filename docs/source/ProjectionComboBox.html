<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;GXC.form.ProjectionComboBox&#39;, {
    extend: &#39;Ext.form.field.ComboBox&#39;,

    inject: [
        &#39;appConfig&#39;,
        &#39;mapService&#39;
    ],

    alias: &#39;widget.gxc_form_projectioncombobox&#39;,

    queryMode: &#39;local&#39;,
    forceSelection: true,
    editable: false,

    initComponent: function() {
        var projections = this.appConfig.get(&#39;projections&#39;),
            map = this.mapService.getMap();

        Ext.apply(this, {
            store: Ext.Object.getKeys(projections),
            value: map.getProjection()
        });

        this.callParent(arguments);
    },

<span id='global-method-onChange'>    /**
</span>     * Updates the query string of window.location to load application with
     * the selected projection.
     *
     * @param  {String} newValue
     */
    onChange: function(newValue) {
        var url = this.updateQueryString(&#39;srs&#39;, newValue);
        window.location.href = url;
    },

<span id='global-method-updateQueryString'>    /**
</span>     * Updates the query string of the url to pass state via url params.
     *
     * @param  {String} key
     * @param  {String} value
     * @param  {String} url
     * @return {String}
     *
     * @private
     */
    updateQueryString: function(key, value, url) {
        var re = new RegExp(&quot;([?&amp;])&quot; + key + &quot;=.*?(&amp;|#|$)(.*)&quot;, &quot;gi&quot;),
            hash;

        if (!url) {
            url = window.location.href;
        }

        if (re.test(url)) {
            if (typeof value !== &#39;undefined&#39; &amp;&amp; value !== null) {
                return url.replace(re, &#39;$1&#39; + key + &quot;=&quot; + value + &#39;$2$3&#39;);
            }
            else {
                hash = url.split(&#39;#&#39;);
                url = hash[0].replace(re, &#39;$1$3&#39;).replace(/(&amp;|\?)$/, &#39;&#39;);
                if (typeof hash[1] !== &#39;undefined&#39; &amp;&amp; hash[1] !== null) {
                    url += &#39;#&#39; + hash[1];
                }
                return url;
            }
        }
        else {
            if (typeof value !== &#39;undefined&#39; &amp;&amp; value !== null) {
                var separator = url.indexOf(&#39;?&#39;) !== -1 ? &#39;&amp;&#39; : &#39;?&#39;;
                hash = url.split(&#39;#&#39;);
                url = hash[0] + separator + key + &#39;=&#39; + value;
                if (typeof hash[1] !== &#39;undefined&#39; &amp;&amp; hash[1] !== null) {
                    url += &#39;#&#39; + hash[1];
                }
                return url;
            }
            else {
                return url;
            }
        }
    }
});
</pre>
</body>
</html>
