<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
This file is part of Ext JS 4.2

Copyright (c) 2011-2013 Sencha Inc

Contact:  http://www.sencha.com/contact

GNU General Public License Usage
This file may be used under the terms of the GNU General Public License version 3.0 as
published by the Free Software Foundation and appearing in the file LICENSE included in the
packaging of this file.

Please review the following information to ensure the GNU General Public License version 3.0
requirements will be met: http://www.gnu.org/copyleft/gpl.html.

If you are unsure which license is appropriate for your use, please contact the sales department
at http://www.sencha.com/contact.

Build date: 2013-05-16 14:36:50 (f9be68accb407158ba2b1be2c226a6ce1f649314)
*/
<span id='Ext-data-association-Association'>/**
</span> * @author Ed Spencer
 *
 * Associations enable you to express relationships between different {@link Ext.data.Model Models}. Let&#39;s say we&#39;re
 * writing an ecommerce system where Users can make Orders - there&#39;s a relationship between these Models that we can
 * express like this:
 *
 *     Ext.define(&#39;User&#39;, {
 *         extend: &#39;Ext.data.Model&#39;,
 *         fields: [&#39;id&#39;, &#39;name&#39;, &#39;email&#39;],
 *
 *         hasMany: {model: &#39;Order&#39;, name: &#39;orders&#39;}
 *     });
 *
 *     Ext.define(&#39;Order&#39;, {
 *         extend: &#39;Ext.data.Model&#39;,
 *         fields: [&#39;id&#39;, &#39;user_id&#39;, &#39;status&#39;, &#39;price&#39;],
 *
 *         belongsTo: &#39;User&#39;
 *     });
 *
 * We&#39;ve set up two models - User and Order - and told them about each other. You can set up as many associations on
 * each Model as you need using the two default types - {@link Ext.data.HasManyAssociation hasMany} and {@link
 * Ext.data.BelongsToAssociation belongsTo}. There&#39;s much more detail on the usage of each of those inside their
 * documentation pages. If you&#39;re not familiar with Models already, {@link Ext.data.Model there is plenty on those too}.
 *
 * **Further Reading**
 *
 *   - {@link Ext.data.association.HasMany hasMany associations}
 *   - {@link Ext.data.association.BelongsTo belongsTo associations}
 *   - {@link Ext.data.association.HasOne hasOne associations}
 *   - {@link Ext.data.Model using Models}
 *
 * # Self association models
 *
 * We can also have models that create parent/child associations between the same type. Below is an example, where
 * groups can be nested inside other groups:
 *
 *     // Server Data
 *     {
 *         &quot;groups&quot;: {
 *             &quot;id&quot;: 10,
 *             &quot;parent_id&quot;: 100,
 *             &quot;name&quot;: &quot;Main Group&quot;,
 *             &quot;parent_group&quot;: {
 *                 &quot;id&quot;: 100,
 *                 &quot;parent_id&quot;: null,
 *                 &quot;name&quot;: &quot;Parent Group&quot;
 *             },
 *             &quot;nested&quot; : {
 *                 &quot;child_groups&quot;: [{
 *                     &quot;id&quot;: 2,
 *                     &quot;parent_id&quot;: 10,
 *                     &quot;name&quot;: &quot;Child Group 1&quot;
 *                 },{
 *                     &quot;id&quot;: 3,
 *                     &quot;parent_id&quot;: 10,
 *                     &quot;name&quot;: &quot;Child Group 2&quot;
 *                 },{
 *                     &quot;id&quot;: 4,
 *                     &quot;parent_id&quot;: 10,
 *                     &quot;name&quot;: &quot;Child Group 3&quot;
 *                 }]
 *             }
 *         }
 *     }
 *
 *     // Client code
 *     Ext.define(&#39;Group&#39;, {
 *         extend: &#39;Ext.data.Model&#39;,
 *         fields: [&#39;id&#39;, &#39;parent_id&#39;, &#39;name&#39;],
 *         proxy: {
 *             type: &#39;ajax&#39;,
 *             url: &#39;data.json&#39;,
 *             reader: {
 *                 type: &#39;json&#39;,
 *                 root: &#39;groups&#39;
 *             }
 *         },
 *         associations: [{
 *             type: &#39;hasMany&#39;,
 *             model: &#39;Group&#39;,
 *             primaryKey: &#39;id&#39;,
 *             foreignKey: &#39;parent_id&#39;,
 *             autoLoad: true,
 *             associationKey: &#39;nested.child_groups&#39; // read child data from nested.child_groups
 *         }, {
 *             type: &#39;belongsTo&#39;,
 *             model: &#39;Group&#39;,
 *             primaryKey: &#39;id&#39;,
 *             foreignKey: &#39;parent_id&#39;,
 *             associationKey: &#39;parent_group&#39; // read parent data from parent_group
 *         }]
 *     });
 *
 *     Ext.onReady(function(){
 *
 *         Group.load(10, {
 *             success: function(group){
 *                 console.log(group.getGroup().get(&#39;name&#39;));
 *
 *                 group.groups().each(function(rec){
 *                     console.log(rec.get(&#39;name&#39;));
 *                 });
 *             }
 *         });
 *
 *     });
 *
 */
Ext.define(&#39;Ext.data.association.Association&#39;, {
    alternateClassName: &#39;Ext.data.Association&#39;,
<span id='Ext-data-association-Association-cfg-ownerModel'>    /**
</span>     * @cfg {String} ownerModel
     * The string name of the model that owns the association.
     *
     * **NB!** This config is required when instantiating the Association directly.
     * However, it cannot be used at all when defining the association as a config
     * object inside Model, because the name of the model itself will be supplied
     * automatically as the value of this config.
     */

<span id='Ext-data-association-Association-cfg-associatedModel'>    /**
</span>     * @cfg {String} associatedModel
     * The string name of the model that is being associated with.
     *
     * **NB!** This config is required when instantiating the Association directly.
     * When defining the association as a config object inside Model, the #model
     * configuration will shadow this config.
     */

<span id='Ext-data-association-Association-cfg-model'>    /**
</span>     * @cfg {String} model
     * The string name of the model that is being associated with.
     *
     * This config option is to be used when defining the association as a config
     * object within Model.  The value is then mapped to #associatedModel when
     * Association is instantiated inside Model.
     */

<span id='Ext-data-association-Association-cfg-primaryKey'>    /**
</span>     * @cfg {String} primaryKey
     * The name of the primary key on the associated model. In general this will be the
     * {@link Ext.data.Model#idProperty} of the Model.
     */
    primaryKey: &#39;id&#39;,

<span id='Ext-data-association-Association-cfg-reader'>    /**
</span>     * @cfg {Ext.data.reader.Reader} reader
     * A special reader to read associated data
     */
    
<span id='Ext-data-association-Association-cfg-associationKey'>    /**
</span>     * @cfg {String} associationKey
     * The name of the property in the data to read the association from. Defaults to the name of the associated model.
     */

    associationKeyFunction : null,

<span id='Ext-data-association-Association-property-defaultReaderType'>    defaultReaderType: &#39;json&#39;,
</span>
<span id='Ext-data-association-Association-property-isAssociation'>    isAssociation: true,
</span>
<span id='Ext-data-association-Association-property-initialConfig'>    initialConfig: null,
</span>
    statics: {
<span id='Ext-data-association-Association-static-property-AUTO_ID'>        AUTO_ID: 1000,
</span>        
<span id='Ext-data-association-Association-static-method-create'>        create: function(association){
</span>            if (Ext.isString(association)) {
                association = {
                    type: association
                };
            }

            switch (association.type) {
                case &#39;belongsTo&#39;:
                    return new Ext.data.association.BelongsTo(association);
                case &#39;hasMany&#39;:
                    return new Ext.data.association.HasMany(association);
                case &#39;hasOne&#39;:
                    return new Ext.data.association.HasOne(association);
                //TODO Add this back when it&#39;s fixed
//                    case &#39;polymorphic&#39;:
//                        return Ext.create(&#39;Ext.data.PolymorphicAssociation&#39;, association);
                default:
                    //&lt;debug&gt;
                    Ext.Error.raise(&#39;Unknown Association type: &quot;&#39; + association.type + &#39;&quot;&#39;);
                    //&lt;/debug&gt;
            }
            return association;
        }
    },

<span id='Ext-data-association-Association-method-constructor'>    /**
</span>     * Creates the Association object.
     * @param {Object} [config] Config object.
     */
    constructor: function(config) {
        Ext.apply(this, config);

        var me              = this,
            types           = Ext.ModelManager.types,
            ownerName       = config.ownerModel,
            associatedName  = config.associatedModel,
            ownerModel      = types[ownerName],
            associatedModel = types[associatedName],
            associationKey  = config.associationKey,
            keyReIdx;

        if (associationKey) {
            keyReIdx = String(associationKey).search(/[\[\.]/);

            if (keyReIdx &gt;= 0) {
                me.associationKeyFunction = Ext.functionFactory(&#39;obj&#39;, &#39;return obj&#39; + (keyReIdx &gt; 0 ? &#39;.&#39; : &#39;&#39;) + associationKey);
            }
        }

        me.initialConfig = config;

        //&lt;debug&gt;
        if (ownerModel === undefined) {
            Ext.Error.raise(&quot;The configured ownerModel was not valid (you tried &quot; + ownerName + &quot;)&quot;);
        }
        if (associatedModel === undefined) {
            Ext.Error.raise(&quot;The configured associatedModel was not valid (you tried &quot; + associatedName + &quot;)&quot;);
        }
        //&lt;/debug&gt;

        me.ownerModel = ownerModel;
        me.associatedModel = associatedModel;

<span id='Ext-data-association-Association-property-ownerName'>        /**
</span>         * @property {String} ownerName
         * The name of the model that &#39;owns&#39; the association
         */

<span id='Ext-data-association-Association-property-associatedName'>        /**
</span>         * @property {String} associatedName
         * The name of the model is on the other end of the association (e.g. if a User model hasMany Orders, this is
         * &#39;Order&#39;)
         */

        Ext.applyIf(me, {
            ownerName : ownerName,
            associatedName: associatedName
        });
        
        me.associationId = &#39;association&#39; + (++me.statics().AUTO_ID);
    },

<span id='Ext-data-association-Association-method-getReader'>    /**
</span>     * Get a specialized reader for reading associated data
     * @return {Ext.data.reader.Reader} The reader, null if not supplied
     */
    getReader: function(){
        var me = this,
            reader = me.reader,
            model = me.associatedModel;

        if (reader) {
            if (Ext.isString(reader)) {
                reader = {
                    type: reader
                };
            }
            if (reader.isReader) {
                reader.setModel(model);
            } else {
                Ext.applyIf(reader, {
                    model: model,
                    type : me.defaultReaderType
                });
            }
            me.reader = Ext.createByAlias(&#39;reader.&#39; + reader.type, reader);
        }
        return me.reader || null;
    }
});
</pre>
</body>
</html>
